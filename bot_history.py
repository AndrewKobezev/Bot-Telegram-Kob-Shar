import telebot

bot = telebot.TeleBot("YOUR_BOT_API_TOKEN_HERE")

# –•—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
user_states = {}  # {user_id: current_state}

# –í–æ–∑–º–æ–∂–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
STATES = {
    "start": "start",
    "choose_entry_point": "choose_entry_point",
    "office_zone": "office_zone",
    "underground": "underground",
    "roof": "roof"
}

# –ö–Ω–æ–ø–∫–∏
def get_keyboard(options):
    markup = telebot.types.ReplyKeyboardMarkup(resize_keyboard=True)
    for option in options:
        markup.add(telebot.types.KeyboardButton(option))
    return markup


# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start
@bot.message_handler(commands=['start'])
def start(message):
    user_id = message.from_user.id
    user_states[user_id] = STATES["start"]

    welcome_text = (
        "üëÅÔ∏è –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é, –ê–≥–µ–Ω—Ç –ù–æ–ª—å.\n\n"
        "–¢–≤–æ—è –º–∏—Å—Å–∏—è ‚Äî —É—Å—Ç—Ä–∞–Ω–∏—Ç—å –∏–ª–∏ –æ–±–µ–∑–≤—Ä–µ–¥–∏—Ç—å –æ–±—ä–µ–∫—Ç –ø–æ –∏–º–µ–Ω–∏ \"–ö–æ—Ä–æ–Ω–∞\". –û–Ω —Å–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ–π –±–∞—à–Ω–µ \"–≠—Ç–µ—Ä–Ω–∏—Å\".\n\n"
        "–£ —Ç–µ–±—è –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Å–ª–µ–¥—É—é—â–∏–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º:\n"
        "- –ü–ª–∞–Ω—à–µ—Ç —Å –∫–∞—Ä—Ç–æ–π –∏ –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö\n"
        "- –ì–∞–∑–æ–≤–∞—è –∫–∞–ø—Å—É–ª–∞ (–ø–∞—Ä–∞–ª–∏–∑—É–µ—Ç –Ω–∞ –∫–æ—Ä–æ—Ç–∫–æ–µ –≤—Ä–µ–º—è)\n"
        "- –ú–∞—Å–∫–∏—Ä–æ–≤–æ—á–Ω—ã–π –∫–æ—Å—Ç—é–º M3\n"
        "- –ì–æ–ª–æ—Å–æ–≤–æ–π –∫–ª–æ–Ω–µ—Ä\n"
        "- –î—Ä–æ–Ω-–ø—Ä–∏–º–∞–Ω–∫–∞\n\n"
        "üîç –í—ã–±–µ—Ä–∏ –ø—É—Ç—å –ø—Ä–æ–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏—è:"
    )

    keyboard = get_keyboard(["–ß–µ—Ä–µ–∑ –æ—Ñ–∏—Å–Ω—É—é –∑–æ–Ω—É", "–ß–µ—Ä–µ–∑ –ø–æ–¥–∑–µ–º–Ω—ã–µ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏", "–° –∫—Ä—ã—à–∏"])
    bot.send_message(message.chat.id, welcome_text, reply_markup=keyboard)


# –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —Ç–æ—á–∫–∏ –ø—Ä–æ–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏—è
@bot.message_handler(func=lambda message: user_states.get(message.from_user.id) == STATES["start"])
def choose_entry_point(message):
    user_id = message.from_user.id
    choice = message.text

    if choice not in ["–ß–µ—Ä–µ–∑ –æ—Ñ–∏—Å–Ω—É—é –∑–æ–Ω—É", "–ß–µ—Ä–µ–∑ –ø–æ–¥–∑–µ–º–Ω—ã–µ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏", "–° –∫—Ä—ã—à–∏"]:
        bot.reply_to(message, "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏ –æ–¥–∏–Ω –∏–∑ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤.")
        return

    if choice == "–ß–µ—Ä–µ–∑ –æ—Ñ–∏—Å–Ω—É—é –∑–æ–Ω—É":
        user_states[user_id] = STATES["office_zone"]
        text = (
            "ü™™ –¢—ã –ø–æ–¥—Ö–æ–¥–∏—à—å –∫ –≥–ª–∞–≤–Ω–æ–º—É –≤—Ö–æ–¥—É. –ù–∞ —Ç–µ–±–µ –º–∞—Å–∫–∏—Ä–æ–≤–æ—á–Ω—ã–π –∫–æ—Å—Ç—é–º M3, –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥ —É–Ω–∏—Ñ–æ—Ä–º—É —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π —Å–ª—É–∂–±—ã.\n"
            "–û—Ö—Ä–∞–Ω–Ω–∏–∫ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç—ã. –ß—Ç–æ –±—É–¥–µ—à—å –¥–µ–ª–∞—Ç—å?"
        )
        buttons = [
            "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–ª–∞–Ω—à–µ—Ç –¥–ª—è —Ñ–∞–ª—å—à–∏–≤—ã—Ö –ø—Ä–∞–≤",
            "–í–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≥–æ–ª–æ—Å–æ–≤—ã–º –∫–ª–æ–Ω–µ—Ä–æ–º",
            "–û—Ç–≤–ª–µ—á—å –≤–Ω–∏–º–∞–Ω–∏–µ –¥—Ä–æ–Ω–æ–º-–ø—Ä–∏–º–∞–Ω–∫–æ–π",
            "–í–µ—Ä–Ω—É—Ç—å—Å—è –æ–±—Ä–∞—Ç–Ω–æ"
        ]

    elif choice == "–ß–µ—Ä–µ–∑ –ø–æ–¥–∑–µ–º–Ω—ã–µ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏":
        user_states[user_id] = STATES["underground"]
        text = (
            "üï≥Ô∏è –¢—ã –Ω–∞—Ö–æ–¥–∏—à—å –∞–≤–∞—Ä–∏–π–Ω—É—é —à–∞—Ö—Ç—É. –†–µ—à—ë—Ç–∫–∞ –∑–∞–∫—Ä—ã—Ç–∞, –Ω–æ —Ç—ã –º–æ–∂–µ—à—å –µ—ë –≤—Å–∫—Ä—ã—Ç—å. –í–Ω—É—Ç—Ä–∏ —Ç–µ–º–Ω–æ.\n"
            "–ß—Ç–æ –±—É–¥–µ—à—å –¥–µ–ª–∞—Ç—å?"
        )
        buttons = [
            "–í—Å–∫—Ä—ã—Ç—å —Ä–µ—à—ë—Ç–∫—É –∏ –ø—Ä–æ–Ω–∏–∫–Ω—É—Ç—å –≤–Ω—É—Ç—Ä—å",
            "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä, —á—Ç–æ–±—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –¥–∞—Ç—á–∏–∫–æ–≤",
            "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–∞–∑, –µ—Å–ª–∏ —Ç–∞–º —Å—Ç–æ—Ä–æ–∂–µ–≤—ã–µ —Å–æ–±–∞–∫–∏",
            "–í–µ—Ä–Ω—É—Ç—å—Å—è –æ–±—Ä–∞—Ç–Ω–æ"
        ]

    elif choice == "–° –∫—Ä—ã—à–∏":
        user_states[user_id] = STATES["roof"]
        text = (
            "ü¶Ö –¢—ã –∑–∞–±–∏—Ä–∞–µ—à—å—Å—è –Ω–∞ –∫—Ä—ã—à—É –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ–π –±–∞—à–Ω–∏. –í–Ω–∏–∑—É –≤–∏–¥–µ–Ω –≤–µ—Ä—Ç–æ–ª—ë—Ç–Ω—ã–π –∞–Ω–≥–∞—Ä –∏ —Å–∏–≥–Ω–∞–ª–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã–µ –¥–∞—Ç—á–∏–∫–∏.\n"
            "–ö–∞–∫ —Å–ø—É—Å—Ç–∏—Ç—å—Å—è?"
        )
        buttons = [
            "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫—Ä—ã—à—É —Å –ø–æ–º–æ—â—å—é –¥—Ä–æ–Ω–∞",
            "–í–∫–ª—é—á–∏—Ç—å –±–ª–æ–∫–∏—Ä–∞—Ç–æ—Ä —Å–∏–≥–Ω–∞–ª–∏–∑–∞—Ü–∏–∏",
            "–°–ø—É—Å—Ç–∏—Ç—å—Å—è –Ω–∞–ø—Ä—è–º—É—é –Ω–∞ –≤–µ—Ä—ë–≤–∫–µ",
            "–í–µ—Ä–Ω—É—Ç—å—Å—è –æ–±—Ä–∞—Ç–Ω–æ"
        ]

    keyboard = get_keyboard(buttons)
    bot.send_message(message.chat.id, text, reply_markup=keyboard)


# –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ñ–∏—Å–Ω–æ–π –∑–æ–Ω—ã
@bot.message_handler(func=lambda message: user_states.get(message.from_user.id) == STATES["office_zone"])
def office_zone_choice(message):
    user_id = message.from_user.id
    choice = message.text

    if choice == "–í–µ—Ä–Ω—É—Ç—å—Å—è –æ–±—Ä–∞—Ç–Ω–æ":
        user_states[user_id] = STATES["start"]
        start(message)
        return

    if choice == "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–ª–∞–Ω—à–µ—Ç –¥–ª—è —Ñ–∞–ª—å—à–∏–≤—ã—Ö –ø—Ä–∞–≤":
        bot.reply_to(message, "‚úÖ –¢—ã —É—Å–ø–µ—à–Ω–æ –≤–æ—à—ë–ª –≤–Ω—É—Ç—Ä—å. –¢–µ–ø–µ—Ä—å —Ç—ã –≤–Ω—É—Ç—Ä–∏ –∑–¥–∞–Ω–∏—è.")

    elif choice == "–í–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≥–æ–ª–æ—Å–æ–≤—ã–º –∫–ª–æ–Ω–µ—Ä–æ–º":
        bot.reply_to(message, "‚úÖ –¢—ã –≤–æ—Å–ø—Ä–æ–∏–∑–≤—ë–ª –ø–∞—Ä–æ–ª—å –¥–Ω—è. –û—Ö—Ä–∞–Ω–Ω–∏–∫ –ø—Ä–æ–ø—É—Å—Ç–∏–ª —Ç–µ–±—è.")

    elif choice == "–û—Ç–≤–ª–µ—á—å –≤–Ω–∏–º–∞–Ω–∏–µ –¥—Ä–æ–Ω–æ–º-–ø—Ä–∏–º–∞–Ω–∫–æ–π":
        bot.reply_to(message, "‚úÖ –¢—ã –∑–∞–ø—É—Å—Ç–∏–ª –¥—Ä–æ–Ω. –û—Ö—Ä–∞–Ω–∞ –æ—Ç–≤–ª–µ—á–µ–Ω–∞. –¢—ã –ø—Ä–æ—à—ë–ª –≤–Ω—É—Ç—Ä—å.")

    else:
        bot.reply_to(message, "‚ùå –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ.")
        return

    buttons = [
        "–ò–∑—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –Ω–∞ –ø–ª–∞–Ω—à–µ—Ç–µ",
        "–ù–∞–π—Ç–∏ —Å–µ–∫—Ä–µ—Ç–∞—Ä—è –∏ –ø–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≥—Ä–∞—Ñ–∏–∫–µ –ö–æ—Ä–æ–Ω—ã",
        "–ü—Ä–æ–Ω–∏–∫–Ω—É—Ç—å –≤ —Å–µ—Ä–≤–µ—Ä–Ω—É—é –∫–æ–º–Ω–∞—Ç—É",
        "–ü–µ—Ä–µ–π—Ç–∏ –∫ —Ñ–∏–Ω–∞–ª—å–Ω–æ–º—É —ç—Ç–∞–∂—É –Ω–∞–ø—Ä—è–º—É—é"
    ]
    keyboard = get_keyboard(buttons)
    bot.send_message(message.chat.id, "–í—ã–±–µ—Ä–∏ –¥–∞–ª—å–Ω–µ–π—à–µ–µ –¥–µ–π—Å—Ç–≤–∏–µ:", reply_markup=keyboard)


# –ó–∞–≥–ª—É—à–∫–∞ –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —à–∞–≥–æ–≤
@bot.message_handler(func=lambda message: user_states.get(message.from_user.id) in [STATES["underground"], STATES["roof"]])
def generic_step(message):
    bot.reply_to(message, f"–í—ã –≤—ã–±—Ä–∞–ª–∏: {message.text}\n–≠—Ç–æ—Ç —à–∞–≥ –µ—â—ë –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ...")


# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
bot.polling(none_stop=True)
